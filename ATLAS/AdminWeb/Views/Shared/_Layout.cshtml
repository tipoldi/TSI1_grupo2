<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - ATLAS Admin</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

</head>
<body>
   
    <div class="navbar navbar-inverse navbar-fixed-top" align="left">

        <div class="container" align="left">

            <div class="navbar-header">

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>
            <div class="navbar-collapse collapse" align="left">
                <ul class="nav navbar-nav" align="left">
                    @*      <li>@Html.ActionLink("Home", "Index", "Home")</li>*@
                    <li><img src="http://localhost:1428/Images/AtlasOtro.jpg" alt="se tiene que ver una IMAGEN!!!! width=" 100" height="100"></li>

                </ul>
                @Html.Partial("_LoginPartial")
            </div>
        </div>
    </div>
    <table>
        <col width="1" />
        <col width="1000" />
        <col width="1" />
        <tr>
            <td align="center" valign="top"> 
               <div class="container LeftMenu">
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Inicio", "Index", "Home")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Edificios", "Index", "Edificios")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Unidades", "Index", "Unidades")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Tecnologias", "Index", "Home")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Recursos", "Index", "Home")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Jugadas", "Index", "Home")</a></p>
                    <p><a class="btn btn-atlas-menu" @Html.ActionLink("Layout", "Index", "Home")</a></p>
            </div>
            </td>
            <td width="200">
                <div class="container body-content">
                    @RenderBody()
                    <hr />
                    <footer>
                        <p>&copy; @DateTime.Now.Year - ATLAS - Plataforma de Juegos Online</p>
                    </footer>
                </div>
            </td>
            <td align="left" valign="top">
                <div class="container body-content-chat ">
                   
                    <div class="container jumbotron ">
                        <h2>Admin Chat</h2>
                        <input type="text" id="message" />
                        <input type="button" id="sendmessage" value="Enviar" class="btn btn-atlas-menu" />
                        <input type="hidden" id="displayname" />
                        <ul id="discussion"></ul>
                    </div>
                    <div class="container jumbotron">
                        <h3>Lista de conectados:</h3>
                        <ul id="listaConectados"></ul>
                    </div>
                </div>
            </td>
        </tr>
</table>
   

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
    @section scripts {
        <!--Script references. -->
        <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
        <!--Reference the SignalR library. -->
        <script src="~/Scripts/jquery.signalR-2.0.0.min.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="~/signalr"></script>
        <!--SignalR script to update the chat page and send messages.-->
        <script>
            $(function () {
                // Reference the auto-generated proxy for the hub.
                var chat = $.connection.myHub1;

                $('#displayname').val(prompt('Ingrese su nombre:', ''));

                // Set initial focus to message input box.
                $('#message').focus();

                // Start the connection.
                $.connection.hub.start().done(function () {
                    chat.server.connect($('#displayname').val());

                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        $('#message').val('').focus();
                    });
                });

                // Calls when user successfully logged in
                chat.client.onConnected = function (id, userName, allUsersId, allUsersUserName) {
                    //for (var UserId in allUsersId) {
                    //    $('#listaConectados').append('<li><strong>' + htmlEncode(allUsersId[UserId]) + '</li>');
                    //    alert("En onConnected lista: "+allUsersId[UserId]);
                    //}
                    for (var UserName in allUsersUserName) {
                        $('#listaConectados').append('<li><strong>' + htmlEncode(allUsersUserName[UserName]) + '</li>');
                        //alert("En onConnected lista: " + allUsersUserName[UserName]);
                    }
                }

                // On New User Connected
                chat.client.onNewUserConnected = function (id, userName) {
                    $('#listaConectados').append('<li><strong>' + userName + '</li>');
                }

                chat.client.onUserDisconnected = function (id, userName) {
                    $('#listaConectados').remove('<li><strong>' + userName + '</li>');
                }

                // Create a function that the hub can call back to display messages.
                chat.client.addNewMessageToPage = function (name, message) {
                    // Add the message to the page.
                    $('#discussion').append('<li><strong>' + htmlEncode(name)
                        + '</strong>: ' + htmlEncode(message) + '</li>');
                };

            });
            // This optional function html-encodes messages for display in the page.
            function htmlEncode(value) {
                var encodedValue = $('<div />').text(value).html();
                return encodedValue;
            }
        </script>
    }
</body>
</html>
